<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_script_client">
    <sys_script_client action="INSERT_OR_UPDATE">
        <active>true</active>
        <applies_extended>false</applies_extended>
        <condition/>
        <description/>
        <field/>
        <global>true</global>
        <isolate_script>true</isolate_script>
        <messages/>
        <name>ผู้ใช้งาน เข้า - ออก </name>
        <order/>
        <script><![CDATA[function onLoad() {

	// 	var syparm = getParmVal('sys_myparm');
	var st_time = g_form.getValue('u_start_dt');
	var ed_time = g_form.getValue('u_end_dt');
	var all_time = g_form.getValue('u_date_all_in');

	var state_case = g_form.getValue('u_state');
	var state = g_form.getValue('u_state_in_out');
	
	
	var url = new GlideURL();
	url.setFromCurrent();
	var record_sysid = url.getParam("sys_id");
	//alert(url.getParam("sys_id"));

	if (top.window.location.href.indexOf("Reservation_hours=in") > -1 && state_case == 1) {
		g_form.setValue('u_brand','dddddddddddddddddddddddddddddd');
		qr();
	}else if (top.window.location.href.indexOf("Daily=in") > -1 && state_case == 1) {
		g_form.setValue('u_brand','Daily');
		qr();
	}


	function qr(){
		var call = new GlideAjax('check_scan_qrcode');
		call.addParam('sysparm_name', 'check');
		call.addParam('st_dt', st_time);
		call.addParam('ed_dt', ed_time);
		call.addParam('all_dt', all_time);
		call.getXML(getResponse);

		function getResponse(response) {
			var result = response.responseXML.documentElement.getAttribute('answer');
			if(result=="Daily-correct"){
				if(state == 1 && state_case == 1){
					g_form.setValue('u_state_in_out',2);
					g_form.save();
				}else if(state == 2 && state_case == 1){
					g_form.setValue('u_state_in_out',3);
					g_form.save();
				}
			}else if(result=="Hourly-correct"){
				if(state == 1 && state_case == 1){
					g_form.setValue('u_state_in_out',2);
					g_form.save();
				}else if(state == 2 && state_case == 1){
					g_form.setValue('u_state_in_out',3);
					g_form.setValue('u_state',2);
					g_form.save();
				}else if(state == 3 && state_case == 2){
					alert("ไม่สามารถเข้าจอดได้คุณไม่ได้ทำการจอง");
				}
			}else{
				alert("ยังไม่ถึงเวลาเข้าจอด");
			}

		}
	}
}]]></script>
        <sys_class_name>sys_script_client</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2023-10-05 10:23:07</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>b81f5800473d751021f49128436d4339</sys_id>
        <sys_mod_count>52</sys_mod_count>
        <sys_name>ผู้ใช้งาน เข้า - ออก </sys_name>
        <sys_overrides/>
        <sys_package display_value="Car parking reservation" source="x_950909_car_park">083c1ad84741311021f49128436d4349</sys_package>
        <sys_policy/>
        <sys_scope display_value="Car parking reservation">083c1ad84741311021f49128436d4349</sys_scope>
        <sys_update_name>sys_script_client_b81f5800473d751021f49128436d4339</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2023-10-06 18:01:42</sys_updated_on>
        <table>x_950909_car_park_detail</table>
        <type>onLoad</type>
        <ui_type>10</ui_type>
        <view/>
    </sys_script_client>
</record_update>
